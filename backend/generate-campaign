from openai import OpenAI
from fastapi import APIRouter

@app.post("/api/generate-campaign")
async def generate_campaign(request: CampaignRequest):
    client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
    
    prompt = build_campaign_prompt(
        cohort=request.cohort,
        zip_code=request.zip_code,
        competitors=request.competitors,
        reasons=request.reasons,
        match_score=request.match_score
    )
    
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.7
    )
    
    return parse_campaign_response(response.choices[0].message.content)